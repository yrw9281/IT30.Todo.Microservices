# Day 22 - RabbitMQ 介紹

## Event - Todo List Removed

上面的 Todo Service 內的 List Remove 功能完成後，這篇章的重點來了，我們需要實作 Todo List Removed Event。

我們複習一下在 **Day 11 - DDD Seedwork 實作** 時做的 `Entity` 如何實作 Event 的功能

```csharp
namespace Common.Library.Seedwork;

public abstract class Entity<TId> where TId : notnull
{
    private readonly List<IDomainEvent> _domainEvents = new();

    public required TId Id { get; init; }
    public DateTime CreatedDateTime { get; set; }
    public DateTime UpdatedDateTime { get; set; }

    public IReadOnlyList<IDomainEvent> DomainEvents => _domainEvents.AsReadOnly();

    public void AddDomainEvent(IDomainEvent domainEvent)
    {
        _domainEvents.Add(domainEvent);
    }

    public void ClearDomainEvents()
    {
        _domainEvents.Clear();
    }
}
```

我們首先要先定義一個 `TodoListRemovedEvent` 繼承 `IDomainEvent`，才可以加入這個 `Entity` 的 `DomainEvents` 內。

而這個 Event 的主要功能就是通知這個 ID 的 Todo List 被 Removed 了。

首先我們在 Todo.Domain 內開一個 `Events` 資料夾，新增 `TodoListRemovedEvent.cs` 如下：

```csharp
using Common.Library.Seedwork;

namespace Todo.Domain.Events;

public class TodoListRemovedEvent : IDomainEvent
{
    public Guid TodoListId { get; }

    public TodoListRemovedEvent(Guid todoListId)
    {
        TodoListId = todoListId;
    }
}
```

然後我們在這個 Todo List 的 Aggregate 觸發 Remove 成功後加入這個 Event

```csharp
    public void Remove()
    {
        Status = TodoListStatus.Removed;
        UpdatedDateTime = DateTime.UtcNow;
        AddDomainEvent(new TodoListRemovedEvent(this.Id.Value));
    }
```
