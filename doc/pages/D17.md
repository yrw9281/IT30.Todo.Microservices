# Day 17 - Todo Service 實作 Create List

## Todo Service 回顧

pic01

很多細節都與前幾篇在實作 Account Service 一致，這邊算是一個複習。我建議讀者可以試著自己寫看看。接下來我還是會照著 Coding 的順序來實作，但解釋會變少，有不理解的可以回去重溫 Account Service 的流程。

## todoList.proto 實作

```protobuf
syntax = "proto3";

option csharp_namespace = "Todo.Grpc";

service TodoListGrpcService {
  rpc CreateTodoList (CreateTodoListRequest) returns (CreateTodoListResponse);
}

message CreateTodoListRequest {
  string UserId = 1;
  string Name = 2;
  string Description = 3;
}

message CreateTodoListResponse {
  string Id = 1;
  string UserId = 2;
  string Name = 3;
  string Description = 4;
}
```

## GrpcTodoListService 實作

```csharp
using Grpc.Core;
using Todo.Application;

namespace Todo.Grpc.Services;

public class GrpcTodoListService : TodoListGrpcService.TodoListGrpcServiceBase
{
    private readonly ITodoListService _todoListService;

    public GrpcTodoListService(ITodoListService todoListService)
    {
        this._todoListService = todoListService;
    }

    public override Task<CreateTodoListResponse> CreateTodoList(CreateTodoListRequest request, ServerCallContext context)
    {
        var result = _todoListService.CreateTodoList(new Guid(request.UserId), request.Name, request.Description);

        CreateTodoListResponse response = new()
        {
            Id = result.Id.ToString(),
            UserId = result.UserId.ToString(),
            Name = result.Name,
            Description = result.Description
        };

        return Task.FromResult(response);
    }
}
```

## 實作 TodoListService

### ITodoListService

```csharp
namespace Todo.Application;

public interface ITodoListService
{
    CreateTodoListResult CreateTodoList(Guid userId, string name, string description);
}
```

### CreateTodoListResult

```csharp
using Todo.Domain.ValueObjects.Enums;

namespace Todo.Application;

public record CreateTodoListResult(
    Guid Id,
    Guid UserId,
    string Name,
    string Description,
    TodoListStatus Status
);
```

### TodoListService

```csharp
using Todo.Domain.Aggregates;

namespace Todo.Application;

public class TodoListService : ITodoListService
{
    private readonly List<TodoList> _todoLists = new();
    
    public CreateTodoListResult CreateTodoList(Guid userId, string name, string description)
    {
        var list = TodoList.Create(name, description, userId);

        _todoLists.Add(list);

        return new CreateTodoListResult(list.Id.Value, list.UserId, list.Name, list.Description, list.Status);
    }
}
```

## Register Service

```csharp
using Microsoft.Extensions.DependencyInjection;

namespace Todo.Application;

public static class TodoApplicationRegister
{
    public static IServiceCollection AddTodoApplication(this IServiceCollection services)
    {
        services.AddScoped<ITodoListService, TodoListService>();

        return services;
    }

}
```

## Program.cs

```csharp
using Todo.Grpc.Services;
using Todo.Application;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddGrpc();
builder.Services.AddGrpcReflection();
builder.Services.AddTodoApplication();

var app = builder.Build();

// Configure the HTTP request pipeline.
app.MapGrpcService<GrpcTodoListService>();
app.MapGrpcReflectionService();

app.Run();
```

## Test

### dotnet run

pic02

### gRPC Clicker Add Schema

pic03

pic04

### gRPC Clicker Test

pic05

## 結語

直到開始時做 Events 之前，接下來的幾個章節都會避免重複講先前已講過的概念與細節，會直接呈現結果，讀者可以自行先實作 Todo Service 的各項功能。

專案架構圖

pic06
